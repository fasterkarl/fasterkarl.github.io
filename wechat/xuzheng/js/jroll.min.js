/*! JRoll v1.2.0 ~ (c) 2015 Author:jlong, Email:jlong@chjtx.com Website:http://www.chjtx.com/JRoll/ */
!function(a,b,c){"use strict";function l(a,b){for(var c=0,d=0;a;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent,a===b&&(a=null);return{left:c,top:d}}function m(a){for(var c;a!==b;){if(c=a.getAttribute("jroll-id"))return k[c];a=a.parentNode}return null}function n(a){var b=m(a.target);b?(d.jrollActive=b,b._start(a)):d.jrollActive=null}function o(a){d.jrollActive&&d.jrollActive._move(a)}function p(){d.jrollActive&&d.jrollActive._end()}function q(a){d.jrollActive&&d.jrollActive._wheel(a)}function r(a){var b=m(a.target);b&&b._focusin(a)}function s(a){var b=m(a.target);b&&b._focusout()}function t(){setTimeout(function(){for(var a in k)k[a].refresh(),k[a].scrollTo(k[a].x,k[a].y)},600)}var d,e=a.requestAnimationFrame||a.webkitRequestAnimationFrame||function(a){setTimeout(a,16)},f=b.createElement("div").style,g="transform"in f?"transform":"-webkit-transform",h="transitionDuration"in f?"transition-duration":"-webkit-transition-duration",i=/mobile|phone|android|pad/.test(navigator.userAgent.toLowerCase()),j=/Android/.test(navigator.userAgent),k={};i?(b.addEventListener("touchstart",n,!1),b.addEventListener("touchmove",o,!1),b.addEventListener("touchend",p,!1),b.addEventListener("touchcancel",p,!1)):(b.addEventListener("mousedown",n,!1),b.addEventListener("mousemove",o,!1),b.addEventListener("mouseup",p,!1),b.addEventListener("mousewheel",q,!1)),a.addEventListener("resize",t,!1),a.addEventListener("orientationchange",t,!1),j&&(b.addEventListener("focusin",r,!1),b.addEventListener("focusout",s,!1)),d=function(d,e){var g,f=this;if(f.wrapper="string"==typeof d?b.querySelector(d):d,f.scroller=e&&e.scroller?"string"==typeof e.scroller?b.querySelector(e.scroller):e.scroller:f.wrapper.children[0],f.scroller.jroll)return f.scroller.jroll.refresh(),f.scroller.jroll;f.scroller.jroll=f,e.scrollFree&&e.bounce&&a.console.warn("为不影响滑动效果，请勿将scrollFree和bounce同时置为true!"),f.wrapperOffset=l(f.wrapper,b.body),f.id=e&&e.id||f.scroller.getAttribute("jroll-id")||"jroll_"+c.random().toString().substr(2,8),f.scroller.setAttribute("jroll-id",f.id),k[f.id]=f,f.options={scroll:!0,scrollX:!0,scrollY:!0,scrollFree:!1,zoom:!1,zoomMin:1,zoomMax:4,bounce:!1,scrollBarX:!1,scrollBarY:!1,scrollBarFade:!1,preventDefault:!0,momentum:!0,autoStyle:!0,g:8e-4,adjustTop:190};for(g in e)"scroller"!==g&&(f.options[g]=e[g]);f.options.autoStyle&&("static"===a.getComputedStyle(f.wrapper).position&&(f.wrapper.style.position="relative"),f.wrapper.style.overflow="hidden",f.scroller.style.minHeight="100%"),f.x=0,f.y=0,f.status=null,f.scrollBarX=null,f.scrollBarY=null,f._scroll={startX:0,startY:0,endX:0,endY:0,lockX:!1,lockY:!1},f._zoom={spacing:0,scale:1,startScale:1},f._event={scrollStart:[],scroll:[],scrollEnd:[],zoomStart:[],zoom:[],zoomEnd:[],refresh:[]},f._event.scrollStart.push(f._defaultScrollStart),f._event.scroll.push(f._defaultScroll),f._event.scrollEnd.push(f._defaultScrollEnd),f.refresh()},d.jrollMap=k,d.prototype={enable:function(){var a=this;return a.scroller.setAttribute("jroll-id",a.id),a},disable:function(){var a=this;return a.scroller.removeAttribute("jroll-id"),a},destroy:function(){var b,a=this;delete k[a.id],delete a.scroller.jroll,a.disable(),a.scroller.style[g]="",a.scroller.style[h]="",a.prototype=null;for(b in a)a.hasOwnProperty(b)&&delete a[b]},call:function(a,b){var c=this;return c._scroll.lockX=!1,c._scroll.lockY=!1,c.status="end",c.scrollTo(c.x,c.y),d.jrollActive=a,b&&a._start(b),a},refresh:function(){var b,a=this;return a.wrapperWidth=a.wrapper.clientWidth,a.wrapperHeight=a.wrapper.clientHeight,a.scrollerWidth=c.round(a.scroller.offsetWidth*a._zoom.scale),a.scrollerHeight=c.round(a.scroller.offsetHeight*a._zoom.scale),a.maxScrollX=a.wrapperWidth-a.scrollerWidth,a.maxScrollY=a.wrapperHeight-a.scrollerHeight,a.maxScrollX>=0?(a.options.bounce||(a._scroll.lockX=!0),a.maxScrollX=0):a._scroll.lockX=!1,a.maxScrollY>=0?(a.options.bounce||(a._scroll.lockY=!0),a.maxScrollY=0):a._scroll.lockY=!1,a._scroll.endX=a.x,a._scroll.endY=a.y,a.options.scrollBarX?(a.scrollBarX||(b=a._createScrollBar("jroll-xbar","jroll-xbtn",!1),a.scrollBarX=b[0],a.scrollBtnX=b[1]),a.scrollBarScaleX=a.wrapper.clientWidth/a.scrollerWidth,a.scrollBtnX.style.width=c.round(a.scrollBarX.clientWidth*a.scrollBarScaleX)+"px"):a.scrollBarX&&(a.wrapper.removeChild(a.scrollBarX),a.scrollBarX=null),a.options.scrollBarY?(a.scrollBarY||(b=a._createScrollBar("jroll-ybar","jroll-ybtn",!0),a.scrollBarY=b[0],a.scrollBtnY=b[1]),a.scrollBarScaleY=a.wrapper.clientHeight/a.scrollerHeight,a.scrollBtnY.style.height=c.round(a.scrollBarY.clientHeight*a.scrollBarScaleY)+"px"):a.scrollBarY&&(a.wrapper.removeChild(a.scrollBarY),a.scrollBarY=null),a._execEvent("refresh"),a},_focusin:function(a){var b=this;setTimeout(function(){var c,d;b.refresh(),c=l(a.target,b.wrapper),d=c.top+b.y,d>b.options.adjustTop&&b.scrollTo(b.x,b.y-d+b.options.adjustTop,400)},600)},_focusout:function(){var a=this;setTimeout(function(){a.refresh(),a.scrollTo(a.x,a.y,400)},600)},_scrollTo:function(a,b){this.scroller.style[g]="translate("+a+"px, "+b+"px) translateZ(0) scale("+this._zoom.scale+")"},scrollTo:function(a,b,c){var d=this;return d._scroll.endX=d.x=a>=0?0:a<=d.maxScrollX?d.maxScrollX:a,d._scroll.endY=d.y=b>=0?0:b<=d.maxScrollY?d.maxScrollY:b,c&&(d.scroller.style[h]=c+"ms",setTimeout(function(){d.scroller.style[h]="0ms"},c)),d._scrollTo(d.x,d.y),d._runScrollBar(),d},scale:function(a){var b=this,c=parseFloat(a);return isNaN(c)||(b.scroller.style["-webkit-transform-origin"]="0 0",b._zoom.scale=c,b.refresh().scrollTo(b.x,b.y,400)),b},_wheel:function(a){var b=this;b.scrollTo(b.x,b._compute(b.y+a.wheelDelta,b.maxScrollY)),b._runScrollBar()},on:function(a,b){var c=this;switch(a){case"scrollStart":c._event.scrollStart.push(b);break;case"scroll":c._event.scroll.push(b);break;case"scrollEnd":c._event.scrollEnd.push(b);break;case"zoomStart":c._event.zoomStart.push(b);break;case"zoom":c._event.zoom.push(b);break;case"zoomEnd":c._event.zoomEnd.push(b);break;case"refresh":c._event.refresh.push(b)}},_execEvent:function(a,b){var d,e,c=this;for(d=0,e=c._event[a].length;e>d;d++)c._event[a][d].call(c,b)},_createScrollBar:function(a,c,d){var e=this,f=b.createElement("div"),g=b.createElement("div");return f.className=a,g.className=c,(this.options.scrollBarX===!0||this.options.scrollBarY===!0)&&(d?(f.style.cssText="background:#999;position:absolute;top:0;right:0;bottom:0;width:3px;height:100%;overflow:hidden;",g.style.cssText="background:#000;position:absolute;top:0;left:0;right:0;"):(f.style.cssText="background:#999;position:absolute;left:0;bottom:0;right:0;height:3px;width:100%;overflow:hidden;",g.style.cssText="background:#000;height:100%;position:absolute;left:0;top:0;bottom:0;")),e.options.scrollBarFade&&(f.style.opacity=0),f.appendChild(g),e.wrapper.appendChild(f),[f,g]},_runScrollBar:function(){var b,d,a=this;!a._scroll.lockX&&a.scrollBtnX&&(b=c.round(-a.x*a.scrollBarScaleX),a._scrollTo.call({scroller:a.scrollBtnX,_zoom:{scale:1}},b,0)),!a._scroll.lockY&&a.scrollBtnY&&(d=c.round(-a.y*a.scrollBarScaleY),a._scrollTo.call({scroller:a.scrollBtnY,_zoom:{scale:1}},0,d))},_bounceFun:function(a,b,c,d){var g,f=this;return b-=16,b>0?(g=c+a*b*b,d?(f._scroll.endY=f.y=g,f._scrollTo(f.x,g)):(f._scroll.endX=f.x=g,f._scrollTo(g,f.y)),f._execEvent("scroll"),e(f._bounceFun.bind(f,a,b,c,d)),void 0):(d?(f._scroll.endY=f.y=c,f._scrollTo(f.x,c)):(f._scroll.endX=f.x=c,f._scrollTo(c,f.y)),f._execEvent("scrollEnd"),void 0)},_defaultScrollStart:function(){var a=this;a.options.scrollBarFade&&(a.scrollBarX&&(a.scrollBarX.style.opacity=1),a.scrollBarY&&(a.scrollBarY.style.opacity=1))},_defaultScroll:function(a){var b=this;b._runScrollBar(),a&&!j&&a.touches&&a.touches[0].pageY<12&&(b.status="end",b.scrollTo(b.x,b.y,400))},_bounceEvent:function(){var d,a=this,e=200,b=a.x>=0?0:a.x<=a.maxScrollX?a.maxScrollX:a.x,c=a.y>=0?0:a.y<=a.maxScrollY?a.maxScrollY:a.y;b!==a.x&&(d=(a.x-b)/4e4,a._bounceFun(d,e,b,!1)),c!==a.y&&(d=(a.y-c)/4e4,a._bounceFun(d,e,c,!0)),b===a.x&&c===a.y&&a._execEvent("scrollEnd")},_defaultScrollEnd:function(){var a=this;a._runScrollBar(),a.options.scrollBarFade&&(a.scrollBarX&&a._fade(a.scrollBarX,2e3),a.scrollBarY&&a._fade(a.scrollBarY,2e3))},_fade:function(a,b){var c=this;("end"===c.status||"start"===c.status)&&b>0&&(b-=25,0===b%100&&(a.style.opacity=b/1e3),e(c._fade.bind(c,a,b)))},_endAction:function(a){var b=this;b._scroll.lockX=!1,b._scroll.lockY=!1,b.status=a||"end",b.options.bounce?b._bounceEvent():b._execEvent("scrollEnd")},_step:function(){var b,d,a=this;if(isNaN(a.timeX)&&(a.timeX=0),isNaN(a.timeY)&&(a.timeY=0),"scroll"!==a.status)return"start"!==a.status?a._endAction():a._endAction("start"),void 0;if(a.options.scrollFree&&a.timeX<=0&&a.timeY<=0)return a._endAction(),void 0;if(!a._scroll.lockX){if(a.timeX<=0&&!a.options.scrollFree)return a._endAction(),void 0;a.speedX=a.timeX<=0&&a.options.scrollFree?0:+(a.directionX+a.timeX*a.options.g),a.x=a._scroll.endX=c.round(a._scroll.endX+16*a.speedX),b=a._compute(a.x,a.maxScrollX),b!==a.x&&(a.x=a._scroll.endX=a.options.bounce&&a.x-b>10?parseInt(a.directionX+25,10)+b:b,a.options.scrollFree||(a.status="end")),a.timeX=a.timeX-16}if(!a._scroll.lockY){if(a.timeY<=0&&!a.options.scrollFree)return a._endAction(),void 0;a.speedY=a.timeY<=0&&a.options.scrollFree?0:+(a.directionY+a.timeY*a.options.g),a.y=a._scroll.endY=c.round(a._scroll.endY+16*a.speedY),d=a._compute(a.y,a.maxScrollY),d!==a.y&&(a.y=a._scroll.endY=a.options.bounce&&a.y-d>10?parseInt(a.directionY+25,10)+d:d,a.options.scrollFree||(a.status="end")),a.timeY=a.timeY-16}a._scrollTo(a.x,a.y),a._execEvent("scroll"),e(a._step.bind(a))},_compute:function(a,b){var d=this;return a>0?d.options.bounce&&a>10?c.round(a/5):0:b>a?d.options.bounce&&b-10>a?c.round(b+(a-b)/5):b:a},_start:function(a){var e,f,b=this,d=a.touches||[a];b.status="start",1===d.length?(b.startTime=Date.now(),b.startPositionX=b._scroll.startX=d[0].pageX,b.startPositionY=b._scroll.startY=d[0].pageY):(b.scroller.style["-webkit-transform-origin"]="0 0",e=c.abs(d[0].pageX-d[1].pageX),f=c.abs(d[0].pageY-d[1].pageY),b._zoom.spacing=c.sqrt(e*e+f*f),b._zoom.startScale=b._zoom.scale,b.originX=c.abs(d[0].pageX+d[1].pageX)/2-b.wrapperOffset.left-b.x,b.originY=c.abs(d[0].pageY+d[1].pageY)/2-b.wrapperOffset.top-b.y)},_move:function(a){var i,e,f,g,h,b=this,d=a.touches||[a];return b.options.preventDefault&&a.preventDefault(),"start"===b.status?(1===d.length&&b.options.scroll?(b.options.scrollFree||b._scroll.lockX||b._scroll.lockY||(c.abs(d[0].pageX-b._scroll.startX)>c.abs(d[0].pageY-b._scroll.startY)?b._scroll.lockY=!0:b._scroll.lockX=!0),b.options.scrollX||(b._scroll.lockX=!0),b.options.scrollY||(b._scroll.lockY=!0),b._execEvent("scrollStart",a),b.status="scroll"):b.options.zoom&&(b._execEvent("zoomStart",a),b.status="zoom"),void 0):"scroll"===b.status?(b._scroll.lockX||(b.x=d[0].pageX-b._scroll.startX+b._scroll.endX,b.x=b._compute(b.x,b.maxScrollX)),b._scroll.lockY||(b.y=d[0].pageY-b._scroll.startY+b._scroll.endY,b.y=b._compute(b.y,b.maxScrollY)),b._scrollTo(b.x,b.y),b._execEvent("scroll",a),Date.now()-b.startTime>200&&(b.startTime=Date.now()-50,b.startPositionX=d[0].pageX,b.startPositionY=d[0].pageY),b._scroll.lockX||(b.distanceX=d[0].pageX-b.startPositionX),b._scroll.lockY||(b.distanceY=d[0].pageY-b.startPositionY),void 0):"zoom"===b.status?(e=c.abs(d[0].pageX-d[1].pageX),f=c.abs(d[0].pageY-d[1].pageY),g=c.sqrt(e*e+f*f),h=g/b._zoom.spacing*b._zoom.startScale,h<b.options.zoomMin?h=b.options.zoomMin:h>b.options.zoomMax&&(h=b.options.zoomMax),i=h/b._zoom.startScale,b.x=c.round(b.originX-b.originX*i+b._scroll.endX),b.y=c.round(b.originY-b.originY*i+b._scroll.endY),b._zoom.scale=h,b._scrollTo(b.x,b.y),b._execEvent("zoom",a),void 0):void 0},_end:function(){var b,f,a=this;return d.jrollActive=null,"start"===a.status&&(a.status="end"),"scroll"===a.status?(a._scroll.endX=a.x,a._scroll.endY=a.y,a.options.momentum?(b=!1,f=!1,a.duration=Date.now()-a.startTime,a.duration<300?(a._scroll.lockX||(a.speedX=a.distanceX/a.duration,a.timeX=c.abs(a.speedX/a.options.g),a.directionX=a.speedX<0?"-":"+",b=!0),a._scroll.lockY||(a.speedY=a.distanceY/a.duration,a.timeY=c.abs(a.speedY/a.options.g),a.directionY=a.speedY<0?"-":"+",f=!0),b||f?e(a._step.bind(a)):a._endAction()):a._endAction()):a._endAction(),void 0):"zoom"===a.status?(a._zoom.scale>a.options.zoomMax?a._zoom.scale=a.options.zoomMax:a._zoom.scale<a.options.zoomMin&&(a._zoom.scale=a.options.zoomMin),a.refresh(),a.x>0?a._scroll.endX=a.x=0:a.x<a.maxScrollX&&(a._scroll.endX=a.x=a.maxScrollX),a.y>0?a._scroll.endY=a.y=0:a.y<a.maxScrollY&&(a._scroll.endY=a.y=a.maxScrollY),a.scrollTo(a.x,a.y,400),a.status="end",a._execEvent("zoomEnd"),void 0):void 0}},"undefined"!=typeof module&&module.exports&&(module.exports=d),"function"==typeof define&&define(function(){return d}),a.JRoll=d}(window,document,Math);